{% extends "../base.html" %}
{% load static %}

{% block extra_css %}
<style>
	body {
		background-image: none;
		background-size: cover;
		background-position: center;
		background-repeat: no-repeat;
		min-height: 100vh;
		z-index: 1;position: relative;
		
	}
	
	.button-grid {
		display: grid;
		grid-template-columns: repeat(4, minmax(0, 1fr));
		grid-template-rows: repeat(5, minmax(0, 1fr));
		gap: 1vw;
		justify-content: stretch;
		align-items: stretch;
		width: 100%;
		max-width: 350px; /* Optional, für maximale Breite */
		margin: 0 auto;
	}
	
	.btn-square {
		border-radius: 12px !important;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 1.8rem;
		min-width: 0;
		min-height: 0;
		aspect-ratio: 1 / 1;
		width: 100%;
		height: auto;
	}
	
	.btn-custom-white {
		color: #212529;
		background-color: #fff;
		border: 1px solid #dee2e6;
		border-radius: 0.375rem;
		transition: background-color 0.15s, box-shadow 0.15s;
		box-shadow: none;
		cursor: pointer;
	}
	
	.btn-custom-white:hover,
	.btn-custom-white:focus {
		color: #212529;
		background-color: #e7f1ff;
		border-color: #86b7fe;
		outline: 0;
		box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, .25);
	}
	
	.btn-active {
		background-color: #e7f1ff !important;
		border-color: #86b7fe !important;
		box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, .25) !important;
	}
	
	
	/* Responsive Anpassung für sehr kleine Bildschirme */
	@media (max-width: 500px) {
		.button-grid {
			max-width: 100vw;
			gap: 1vw;
		}
		
		.btn-square, .btn-tall {
			font-size: 1rem;
			border-radius: 10px !important;
		}
	}
	
	.block-bg {
		background: none !important;
		padding: 0;
	}
	
	.block-top {
		background: url("{% static 'sudoku/img/playboard/block-top.png' %}") top center no-repeat;
		background-size: 100% auto;
		height: 40px;
		min-height: 30px;
		width: 100%;
	}
	
	.block-bottom {
		background: url("{% static 'sudoku/img/playboard/block-bottom.png' %}") bottom center no-repeat;
		background-size: 100% auto;
		height: 20px;
		min-height: 20px;
		width: 100%;
	}
	
	.block-content {
		background: url("{% static 'sudoku/img/playboard/block-content.png' %}") top center repeat-y;
		background-size: 100% auto;
		width: 100%;
	}
	
	.timer {
		font-size: 2rem;
		font-weight: bold;
		margin-bottom: 10px;
	}

</style>

<link rel="stylesheet" href="{% static 'sudoku/css/board.css' %}">

{% endblock %}

{% block content %}
<div class="row">
	<!-- Linke Spalte -->
	<div class="col-3 block-bg pt-3">
		<div class="block-top"></div>
		<div class="block-content justify-content-start p-3">
			<div class="button-grid">
				<!-- 1. Zeile -->
				<button class="btn btn-custom-white btn-square"><i class="bi bi-gear"></i></button>
				<button class="btn btn-custom-white btn-square"><i class="bi bi-arrow-counterclockwise"></i></button>
				<button class="btn btn-custom-white btn-square"><i class="bi bi-arrow-clockwise"></i></button>
				<button class="btn btn-custom-white btn-square"><i class="bi bi-ban"></i></button>
				<!-- 2. Zeile -->
				<button class="btn btn-custom-white btn-square">7</button>
				<button class="btn btn-custom-white btn-square">8</button>
				<button class="btn btn-custom-white btn-square">9</button>
				<button id="minusBtn" class="btn btn-custom-white btn-square">-</button>
				<!-- 3. Zeile -->
				<button class="btn btn-custom-white btn-square">4</button>
				<button class="btn btn-custom-white btn-square">5</button>
				<button class="btn btn-custom-white btn-square">6</button>
				<button id="plusBtn" class="btn btn-custom-white btn-square">+</button>
				<!-- 4. Zeile -->
				<button class="btn btn-custom-white btn-square">1</button>
				<button class="btn btn-custom-white btn-square">2</button>
				<button class="btn btn-custom-white btn-square">3</button>
				<button id="toggleEyeBtn" class="btn btn-custom-white btn-square"><i class="bi bi-eye"></i></button>
				<!-- 5. Zeile -->
				<button id="eingabemodus-zahl" class="btn btn-custom-white btn-square"><i class="bi bi-pencil-square"></i></button>
				<button id="eingabemodus-oben" class="btn btn-custom-white btn-square"><i class="bi bi-arrow-up-left-square"></i></button>
				<button id="eingabemodus-mitte" class="btn btn-custom-white btn-square"><i class="bi bi-dash-square"></i></button>
				<button id="eingabemodus-farbe" class="btn btn-custom-white btn-square"> <img src="{% static 'sudoku/img/playboard/btn-farbe.svg' %}" alt="Icon" width="24" height="24" /></button>
			</div>
		</div>
		<div class="block-bottom"></div>
	</div>
	
	<!-- Mittlere Spalte -->
	<div class="col-6">
		<div class="board-container w-100">
			<!-- Hier kommt dein Sudoku-Board rein -->
		</div>
	</div>
	
	<!-- Rechte Spalte -->
	<div class="col-3 block-bg d-flex flex-column pt-3">
		<div class="block-top"></div>
		<div class="block-content justify-content-start px-3">
			<div class="timer" id="timer">0:00:00</div>
			<div class="mb-3">Beste Zeit:</div>
			<div class="mb-2 fw-bold">RULES:</div>
			<div class="accordion" id="regelnAccordion">
				{% for i in "123" %}
				<div class="accordion-item">
					<h2 class="accordion-header" id="heading{{ i }}">
						<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ i }}">
							{{ i }}
						</button>
					</h2>
					<div id="collapse{{ i }}" class="accordion-collapse collapse" data-bs-parent="#regelnAccordion">
						<div class="accordion-body">
							Regel {{ i }} Text.
						</div>
					</div>
				</div>
				{% endfor %}
			</div>
			<!-- Select-Menü für Theme-Auswahl -->
			<div class="mt-3 pb-3">
				<label for="themeSelect" class="form-label">Theme wählen:</label>
				<select id="themeSelect" class="form-select" style="width:100%">
					<option value="classic">Classic</option>
					<option value="stone">Stone</option>
					<option value="glow">Glow</option>
					<option value="zement">Zement</option>
					<option value="wood">Wood</option>
				</select>
			</div>
		</div>
		<div class="block-bottom"></div>
	</div>
</div>
{% endblock %}

export function createSelectionConfig(opts = {}) {
return {
target              : opts.target     ?? RegionType.CELLS,
mode                : opts.mode       ?? SelectionMode.SINGLE,
showVisual          : opts.showVisual ?? true,
preserveOnModifier  : opts.preserveOnModifier ?? null,

// General item listeners (used depending on current target)
onItemsChanged      : opts.onItemsChanged      ?? (() => {}),
onItemsAdded        : opts.onItemsAdded        ?? (() => {}),
onItemsRemoved      : opts.onItemsRemoved      ?? (() => {}),
onItemsCleared      : opts.onItemsCleared      ?? (() => {}),

// Optional exclusions for other targets
excludeEdges        : opts.excludeEdges        ?? [],
excludeCorners      : opts.excludeCorners      ?? [],
};
}

{% block extra_scripts %}
<script type="module">
    import {createBoard} from "{% static 'sudoku/js/ui/board/board.js' %}";
    import {createSelectionConfig} from "{% static 'sudoku/js/ui/board/board_selectionConfig.js' %}";

    const div = document.querySelector('.board-container');

    let board = createBoard(div);
    board.initBoard();
    board.setSelection(
        createSelectionConfig({
            target: 'cells',
            mode: 'multiple',
            showVisual: true,
            preserveOnModifier: null,
        })
    )
</script>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Timer functionality
        let seconds = 0;
        const timerElement = document.getElementById('timer');

        function formatTime(sec) {
            const h = Math.floor(sec / 3600);
            const m = Math.floor((sec % 3600) / 60);
            const s = sec % 60;
            return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        if (timerElement) {
            setInterval(()=>{
                seconds++;
            timerElement.textContent = formatTime(seconds);
        },
            1000
        )
            ;
        }

        // Font size control functionality
        let currentFontSize = 1.8;
        const gridButtons = document.querySelectorAll('.button-grid .btn-square');
        const plusBtn = Array.from(gridButtons).find(btn => btn.textContent.trim() === '+'
    )
        ;
        const minusBtn = Array.from(gridButtons).find(btn => btn.textContent.trim() === '-'
    )
        ;

        function updateFontSize() {
            gridButtons.forEach(btn => {
                btn.style.fontSize = currentFontSize + 'rem';
        })
            ;
        }

        if (plusBtn) {
            plusBtn.addEventListener('click', () => {
                currentFontSize += 0.2;
            updateFontSize();
        })
            ;
        }

        if (minusBtn) {
            minusBtn.addEventListener('click', () => {
                currentFontSize = Math.max(0.3, currentFontSize - 0.2);
            updateFontSize();
        })
            ;
        }

        document.addEventListener('keydown', function (event) {
            if (event.key === '+' || event.key === 'Add') {
                plusBtn
            ?.
                click();
                event.preventDefault();
            }
            if (event.key === '-' || event.key === 'Subtract') {
                minusBtn
            ?.
                click();
                event.preventDefault();
            }
        });

        // Eye icon toggle functionality
        const icons = ['bi-eye', 'bi-eye-fill', 'bi-eye-slash-fill'];
        const btn = document.getElementById('toggleEyeBtn');
        if (btn) {
            const iconElem = btn.querySelector('i');
            let iconIndex = 0; // Start with bi-eye-fill

            btn.addEventListener('click', function () {
                icons.forEach(cls => iconElem.classList.remove(cls)
            )
                ;
                iconIndex = (iconIndex + 1) % icons.length;
                iconElem.classList.add(icons[iconIndex]);
            });
        }

        
        // EINGABE_MODUS
        const btnZahl = document.getElementById('eingabemodus-zahl');
        const btnOben = document.getElementById('eingabemodus-oben');
        const btnMitte = document.getElementById('eingabemodus-mitte');
        const btnFarbe = document.getElementById('eingabemodus-farbe');

        const buttons = [btnZahl, btnOben, btnMitte, btnFarbe];

        function activateButton(activeBtn) {
            buttons.forEach(btn => btn.classList.remove('btn-active'));
            activeBtn.classList.add('btn-active');
        }

// Initial: Zahl ist aktiv
        activateButton(btnZahl);

// Klick-Events
        btnZahl.addEventListener('click', () => activateButton(btnZahl));
        btnOben.addEventListener('click', () => activateButton(btnOben));
        btnMitte.addEventListener('click', () => activateButton(btnMitte));
        btnFarbe.addEventListener('click', () => activateButton(btnFarbe));
	    
// Hilfsfunktion: Aktuell aktiven Button finden
        function getActiveIndex() {
            return buttons.findIndex(btn => btn.classList.contains('btn-active'));
        }

// Event-Listener für die Space-Taste
        document.addEventListener('keydown', function(event) {
            // Prüfe, ob die Space-Taste gedrückt wurde (event.code ist moderner und sicherer)
            if (event.code === 'Space') {
                event.preventDefault(); // Verhindert z.B. Scrollen auf der Seite
                let currentIndex = getActiveIndex();
                // Nächsten Index berechnen (rücksetzen auf 0, falls am Ende)
                let nextIndex = (currentIndex + 1) % buttons.length;
                activateButton(buttons[nextIndex]);
            }
        });


        
        // Theme select functionality
        const backgrounds = {
            stone: "url('{% static 'sudoku/img/playboard/stone.jpg' %}')",
            glow: "url('{% static 'sudoku/img/playboard/glow.jpg' %}')",
            zement: "url('{% static 'sudoku/img/playboard/zement.jpg' %}')",
            wood: "url('/static/sudoku/img/playboard/wood.jpg')",
            classic: "none"
        };

        const themeSelect = document.getElementById('themeSelect');
        if (themeSelect) {
            themeSelect.addEventListener('change', function () {
                const bg = backgrounds[this.value];
                document.body.style.backgroundImage = bg || "none";
            });
        }


    });

</script>

{% endblock %}
