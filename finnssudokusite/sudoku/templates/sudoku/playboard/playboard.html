{% extends "../base.html" %}
{% load static %}

{% block extra_css %}
<style>
	body {
		background-image: url("{% static 'sudoku/img/backgrounds/wood.jpg' %}");
		background-size: cover;
		background-position: center;
		background-repeat: no-repeat;
		min-height: 100vh;
	}

	.button-grid {
		display: grid;
		grid-template-columns: repeat(4, 60px);
		grid-template-rows: repeat(5, 60px);
		gap: 10px;
		justify-content: start;
	}

	.btn-square {
		width: 60px;
		height: 60px;
		border-radius: 15px !important;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		font-size: 1.2rem;
	}

	.btn-wide {
		grid-column: 1 / span 2;
		grid-row: 5;
		width: 130px;
	}

	.btn-tall {
		grid-column: 4;
		grid-row: 4 / span 2;
		height: 130px;
	}

	.btn-custom-white {
		background-color: rgba(0, 0, 0, 0.3) !important;
		color: #fff !important;
		border-top: 2px solid rgba(0,0,0,0.8);
		border-left: 2px solid rgba(0,0,0,0.8);
		border-bottom: 2px solid rgba(255,255,255,0.3);
		border-right: 2px solid rgba(255,255,255,0.3);
		box-shadow: none;
		font-size: 1.2rem;
	}

	.btn-custom-white:hover,
	.btn-custom-white:focus {
		background-color: rgba(0, 0, 0, 0.5) !important;
		color: #fff !important;
	}

	.rechte-spalte-bg {
		background: none !important;
		padding: 0;
	}

	.block-top {
		background: url("{% static 'sudoku/img/backgrounds/block-top.png' %}") top center no-repeat;
		background-size: 100% auto;
		height: 40px;
		min-height: 30px;
		width: 100%;
	}

	.block-bottom {
		background: url("{% static 'sudoku/img/backgrounds/block-bottom.png' %}") bottom center no-repeat;
		background-size: 100% auto;
		height: 20px;
		min-height: 20px;
		width: 100%;
	}

	.block-content {
		background: url("{% static 'sudoku/img/backgrounds/block-content.png' %}") top center repeat-y;
		background-size: 100% auto;
		width: 100%;
	}

	.timer {
		font-size: 2rem;
		font-weight: bold;
		margin-bottom: 10px;
	}

</style>

<link rel="stylesheet" href="{% static 'sudoku/css/board.css' %}">

{% endblock %}

{% block content %}
<div class="row">
	<!-- Linke Spalte -->
	<div class="col-4">
		<div class="button-grid">
			<!-- 1. Zeile -->
			<button class="btn btn-custom-white btn-square"><i class="bi bi-gear"></i></button>
			<button class="btn btn-custom-white btn-square"><i class="bi bi-arrow-counterclockwise"></i></button>
			<button class="btn btn-custom-white btn-square"><i class="bi bi-arrow-clockwise"></i></button>
			<button class="btn btn-custom-white btn-square"><i class="bi bi-ban"></i></button>
			<!-- 2. Zeile -->
			<button class="btn btn-custom-white btn-square">7</button>
			<button class="btn btn-custom-white btn-square">8</button>
			<button class="btn btn-custom-white btn-square">9</button>
			<button class="btn btn-custom-white btn-square">-</button>
			<!-- 3. Zeile -->
			<button class="btn btn-custom-white btn-square">4</button>
			<button class="btn btn-custom-white btn-square">5</button>
			<button class="btn btn-custom-white btn-square">6</button>
			<button class="btn btn-custom-white btn-square">+</button>
			<!-- 4. Zeile -->
			<button class="btn btn-custom-white btn-square">1</button>
			<button class="btn btn-custom-white btn-square">2</button>
			<button class="btn btn-custom-white btn-square">3</button>
			<button class="btn btn-custom-white btn-square btn-tall"><i class="bi bi-9-square"></i></button>
			<!-- 5. Zeile -->
			<button class="btn btn-custom-white btn-square btn-wide">0</button>
			<button class="btn btn-custom-white btn-square">klein</button>
		</div>
	</div>

	<!-- Mittlere Spalte -->
	<div class="col-6">
		<div class="board-container w-100">
			<!-- Hier kommt dein Sudoku-Board rein -->
		</div>
	</div>

	<!-- Rechte Spalte -->
	<div class="col-2 rechte-spalte-bg d-flex flex-column p-0">
		<div class="block-top"></div>
		<div class="block-content justify-content-start px-3">
			<div class="timer" id="timer">0:00:00</div>
			<div class="mb-3">Beste Zeit:</div>
			<div class="mb-2 fw-bold">REGELN:</div>
			<div class="accordion" id="regelnAccordion">
				{% for i in "123" %}
				<div class="accordion-item">
					<h2 class="accordion-header" id="heading{{ i }}">
						<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ i }}">
							{{ i }}
						</button>
					</h2>
					<div id="collapse{{ i }}" class="accordion-collapse collapse" data-bs-parent="#regelnAccordion">
						<div class="accordion-body">
							Regel {{ i }} Text.
						</div>
					</div>
				</div>
				{% endfor %}
			</div>
		</div>
		<div class="block-bottom"></div>
	</div>
</div>
{% endblock %}

export function createSelectionConfig(opts = {}) {
return {
target              : opts.target     ?? RegionType.CELLS,
mode                : opts.mode       ?? SelectionMode.SINGLE,
showVisual          : opts.showVisual ?? true,
preserveOnModifier  : opts.preserveOnModifier ?? null,

// General item listeners (used depending on current target)
onItemsChanged      : opts.onItemsChanged      ?? (() => {}),
onItemsAdded        : opts.onItemsAdded        ?? (() => {}),
onItemsRemoved      : opts.onItemsRemoved      ?? (() => {}),
onItemsCleared      : opts.onItemsCleared      ?? (() => {}),

// Optional exclusions for other targets
excludeEdges        : opts.excludeEdges        ?? [],
excludeCorners      : opts.excludeCorners      ?? [],
};
}

{% block extra_scripts %}
<script type="module">
	import { createBoard } from "{% static 'sudoku/js/ui/board.js' %}";
	import { createSelectionConfig } from "{% static 'sudoku/js/ui/board_selectionConfig.js' %}";

	const div = document.querySelector('.board-container');
	console.log(div);

	let board = createBoard(div);
	board.initBoard();
	board.setSelection(
		createSelectionConfig({
			target: 'edges',
			mode: 'single',
			showVisual: true,
			preserveOnModifier: null,
			onItemsChanged: (items) => {
				console.log('Items changed:', items);
			},
			onItemsAdded: (items) => {
				console.log('Items added:', items);
			},
			onItemsRemoved: (items) => {
				console.log('Items removed:', items);
			},
		})
	)
</script>


<script>
	let seconds = 0;
	const timerElement = document.getElementById('timer');

	function formatTime(sec) {
		const h = Math.floor(sec / 3600);
		const m = Math.floor((sec % 3600) / 60);
		const s = sec % 60;
		return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
	}

	setInterval(() => {
		seconds++;
		timerElement.textContent = formatTime(seconds);
	}, 1000);
</script>

<script>
	let currentFontSize = 1.2;
	const gridButtons = document.querySelectorAll('.button-grid .btn-square');
	const plusBtn = Array.from(gridButtons).find(btn => btn.textContent.trim() === '+');
	const minusBtn = Array.from(gridButtons).find(btn => btn.textContent.trim() === '-');

	function updateFontSize() {
		gridButtons.forEach(btn => {
			btn.style.fontSize = currentFontSize + 'rem';
		});
	}

	plusBtn?.addEventListener('click', () => {
		currentFontSize += 0.1;
		updateFontSize();
	});

	minusBtn?.addEventListener('click', () => {
		currentFontSize = Math.max(0.3, currentFontSize - 0.1);
		updateFontSize();
	});

	document.addEventListener('keydown', function(event) {
		if (event.key === '+' || event.key === 'Add') {
			plusBtn?.click();
			event.preventDefault();
		}
		if (event.key === '-' || event.key === 'Subtract') {
			minusBtn?.click();
			event.preventDefault();
		}
	});
</script>
{% endblock %}
