{% extends "sudoku/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'sudoku/css/board.css' %}">
<link rel="stylesheet" href="{% static 'sudoku/css/accordion.css' %}">
{% endblock %}

{% block content %}
<h2 class="text-center mt-4">Create Your Sudoku</h2>
  <div class="container-fluid mt-4">
    <div class="row h-100">
      <!-- LEFT COLUMN -->
      <div class="col-12 col-xl-3 d-flex flex-column p-3">
        <!-- this box fills the col and scrolls internally -->
        <div class="w-100 border rounded whitebox flex-fill overflow-auto pt-3">
          <div id="ruleAccordion" class="accordion" style="max-height: 500px; overflow-y: scroll"></div>
        </div>
      </div>

      <!-- CENTER COLUMN (the height “driver”) -->
      <div class="col-12 col-xl-6  d-flex flex-column p-3">
        <div class="w-100 border rounded whitebox flex-fill">
          {% include "sudoku/creator/board.html" %}
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="col-12 col-xl-3  d-flex flex-column p-3">
        <div class="w-100 border rounded whitebox flex-fill pt-3">
          {% include "sudoku/creator/creator_solutioncheck.html" %}
        </div>
      </div>
    </div>

{% endblock %}

{% block extra_scripts %}
    <script>
      // grab the two boxes
      const centerBox    = document.querySelector('.col-md-6 .whitebox');
      const accordionEl  = document.getElementById('ruleAccordion');

      // a little helper that copies the center–box height into the accordion’s max-height
      function syncAccordionHeight() {
        const w = centerBox.getBoundingClientRect().width;
        accordionEl.style.maxHeight = Math.floor(w - 30) + 'px';
      }

      // whenever the center box resizes (or on load), re-sync
      new ResizeObserver(syncAccordionHeight).observe(centerBox);
      window.addEventListener('load',   syncAccordionHeight);
      window.addEventListener('resize', syncAccordionHeight);
    </script>
<script>
  window.IS_CREATOR_MODE = true;
</script>
<script type="module">
  import { createBoard } from "{% static 'sudoku/js/ui/board.js' %}";
  import { setupCreatorUI } from "{% static 'sudoku/js/ui/creator_ui.js' %}";


  import {
    Board,
  } from "{% static 'sudoku/js/solver/board.js' %}";
  import {StandardRule} from "{% static 'sudoku/js/solver/rules/include.js' %}";
  import {Position} from "{% static 'sudoku/js/solver/position.js' %}";

  const board_solver = new Board();
  board_solver.addRule(new StandardRule());
  let solutions = board_solver.solve(10);
  console.log(solutions[0].toString(false));
  console.log(solutions[1].toString(false));

  const container = document.querySelector(".board-container");
  const canvas    = document.getElementById("board-canvas");
  const grid      = document.getElementById("sudoku-board");

  const board = createBoard(container, canvas, grid);
  window.Board = board; // optional: make globally accessible

  board.initBoard();
  setupCreatorUI(board);
</script>
{% endblock %}
