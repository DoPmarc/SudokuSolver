{% if attempted_stats %}
{% load form_filters %}
{% load static %}
{% load formatting star_rating %}

<!-- Shared Search & Tag Filter -->
{% include "sudoku/profile/search_filter.html" with search_id="doneSearch" tag_class="done-tag-filter" tag_prefix="done-tag" %}

<!-- Solved Puzzles Table -->
<div class="table-responsive" style="min-height: 400px;">
  <table class="table table-striped table-hover small align-middle" id="doneTable">
    <thead>
    <tr>
      <th data-key="name">Name <span class="sort-indicator"></span></th>
      <th data-key="creator">Creator <span class="sort-indicator"></span></th>
      <th data-key="solves">Solved / Attempts <span class="sort-indicator"></span></th>
      <th data-key="rating">Rating <span class="sort-indicator"></span></th>
      <th data-key="avgtime">Avg Time <span class="sort-indicator"></span></th>
      <th data-key="besttime">Your Time <span class="sort-indicator"></span></th>
      <th data-key="datesolved">Last Solved <span class="sort-indicator"></span></th>
      <th>Tags</th>
    </tr>
    </thead>
    <tbody>
    {% for stat in attempted_stats %}
    <tr data-name="{{ stat.sudoku.title|lower }}"
        data-creator="{{ stat.sudoku.created_by.username }}"
        data-solves="{{ stat.sudoku.solves }}"
        data-attempts="{{ stat.sudoku.attempts }}"
        data-rating="{{ stat.sudoku.average_rating|default:0 }}"
        data-avgtime="{{ stat.sudoku.average_time|floatformat:0 }}"
        data-besttime="{{ stat.best_time }}"
        data-datesolved="{{ stat.date_solved|date:"U" }}"
    data-tags="{{ stat.sudoku.tags.all|join:','|lower }}">
    <td>{{ stat.sudoku.title }}</td>
    <td>{{ stat.sudoku.created_by.username }}</td>
    <td>{{ stat.sudoku.solves }} / {{ stat.sudoku.attempts }}</td>
    <td>{% render_starbar stat.sudoku.average_rating %}</td>
    <td>{{ stat.sudoku.average_time|humantime }}</td>
    <td>{{ stat.best_time|humantime }}</td>
    <td>{{ stat.date_solved|date:"Y-m-d H:i" }}</td>
    <td>
      {% for tag in stat.sudoku.tags.all %}
      <span class="badge me-1 mb-1 p-1 badge-{{ tag.name }}">{{ tag.name }}</span>
      {% endfor %}
    </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination Placeholder -->
<nav>
  <ul class="pagination justify-content-center mt-3" id="doneTable-pagination"></ul>
</nav>

<!-- JS Hook -->
<script type="module">
  import { initTableFilter } from "/static/sudoku/js/util/table_filter.js";

  initTableFilter({
    tableId: "doneTable",
    searchInputId: "doneSearch",
    tagClass: "done-tag-filter",
    tagAttribute: "data-tags",
    columns: ["name", "creator", "solves", "rating", "avgtime", "besttime", "datesolved"],
    rowsPerPage: 10
  });
</script>

{% else %}
<p>You havenâ€™t attempted any puzzles yet.</p>
{% endif %}
